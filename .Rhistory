vr_total_change, vr_total_pct_change,
vr_male_change, vr_male_pct_change, vr_fem_change, vr_fem_pct_change,
vr_kuchi_change, vr_kuchi_pct_change, vr_sikh_change, vr_sikh_pct_change) %>%
arrange(province_code, district_sub_code, pc_code)
province_summary <- output %>% group_by(province_code) %>%
summarize(
total_known_pcs = length(pc_code),
planned_pcs_18 = length(pc_code[planned_18 == "YES"]),
prelim_results_pcs_18 = length(pc_code[prelim_results_18 == "YES"]),
final_results_pcs_18 = length(pc_code[final_results_18 == "YES"]),
pcs_with_vr_18 = length(pc_code[!is.na(vr_final_total_18)]),
pcs_with_vr_not_planned_18 = length(pc_code[!is.na(vr_final_total_18) & planned_18 == "NO"]),
pcs_planned_but_missing_vr_18 = length(pc_code[is.na(vr_final_total_18) & planned_18 == "YES"]),
total_prelim_votes_18 = sum(prelim_votes_18, na.rm = T),
total_final_votes_18 = sum(final_votes_18, na.rm = T),
pcs_with_vr_19 = length(pc_code[!is.na(vr_prelim_total_19)]),
pcs_missing_from_vr_19 = length(pc_code[missing_vr_19 == "YES"]),
pcs_that_added_vr_19 = length(pc_code[new_vr_19 == "NEW"]),
prelim_total_vr_18 = sum(vr_prelim_total_18, na.rm = T),
final_planned_total_vr_18 = sum(vr_final_total_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_male_18 = sum(vr_male_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_fem_18 = sum(vr_fem_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_kuchi_18 = sum(vr_kuchi_18[planned_18 == "YES"]),
final_planned_vr_sikh_18 = sum(vr_sikh_18[planned_18 == "YES"]),
prelim_total_vr_19 = sum(vr_prelim_total_19, na.rm = T),
prelim_vr_male_19 = sum(vr_male_19, na.rm = T),
prelim_vr_fem_19 = sum(vr_fem_19, na.rm = T),
prelim_vr_kuchi_19 = sum(vr_kuchi_19, na.rm = T),
prelim_vr_sikh_19 = sum(vr_sikh_19, na.rm = T),
total_vr_net_change = prelim_total_vr_19 - final_planned_total_vr_18,
total_vr_pct_change = total_vr_net_change / final_planned_total_vr_18,
vr_male_net_change = prelim_vr_male_19 - final_planned_vr_male_18,
vr_male_pct_change = vr_male_net_change / final_planned_vr_male_18,
vr_fem_net_change = prelim_vr_fem_19 - final_planned_vr_fem_18,
vr_fem_pct_change = vr_fem_net_change / final_planned_vr_fem_18,
vr_kuchi_net_change = prelim_vr_kuchi_19 / final_planned_vr_kuchi_18,
vr_kuchi_pct_change = vr_kuchi_net_change / final_planned_vr_kuchi_18,
vr_sikh_net_change = prelim_vr_sikh_19 - final_planned_vr_sikh_18,
vr_sikh_pct_change = vr_sikh_net_change / final_planned_vr_sikh_18
)
province_summary <- output %>% group_by(province_code, province_name_eng) %>%
summarize(
total_known_pcs = length(pc_code),
planned_pcs_18 = length(pc_code[planned_18 == "YES"]),
prelim_results_pcs_18 = length(pc_code[prelim_results_18 == "YES"]),
final_results_pcs_18 = length(pc_code[final_results_18 == "YES"]),
pcs_with_vr_18 = length(pc_code[!is.na(vr_final_total_18)]),
pcs_with_vr_not_planned_18 = length(pc_code[!is.na(vr_final_total_18) & planned_18 == "NO"]),
pcs_planned_but_missing_vr_18 = length(pc_code[is.na(vr_final_total_18) & planned_18 == "YES"]),
total_prelim_votes_18 = sum(prelim_votes_18, na.rm = T),
total_final_votes_18 = sum(final_votes_18, na.rm = T),
pcs_with_vr_19 = length(pc_code[!is.na(vr_prelim_total_19)]),
pcs_missing_from_vr_19 = length(pc_code[missing_vr_19 == "YES"]),
pcs_that_added_vr_19 = length(pc_code[new_vr_19 == "NEW"]),
prelim_total_vr_18 = sum(vr_prelim_total_18, na.rm = T),
final_planned_total_vr_18 = sum(vr_final_total_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_male_18 = sum(vr_male_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_fem_18 = sum(vr_fem_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_kuchi_18 = sum(vr_kuchi_18[planned_18 == "YES"]),
final_planned_vr_sikh_18 = sum(vr_sikh_18[planned_18 == "YES"]),
prelim_total_vr_19 = sum(vr_prelim_total_19, na.rm = T),
prelim_vr_male_19 = sum(vr_male_19, na.rm = T),
prelim_vr_fem_19 = sum(vr_fem_19, na.rm = T),
prelim_vr_kuchi_19 = sum(vr_kuchi_19, na.rm = T),
prelim_vr_sikh_19 = sum(vr_sikh_19, na.rm = T),
total_vr_net_change = prelim_total_vr_19 - final_planned_total_vr_18,
total_vr_pct_change = total_vr_net_change / final_planned_total_vr_18,
vr_male_net_change = prelim_vr_male_19 - final_planned_vr_male_18,
vr_male_pct_change = vr_male_net_change / final_planned_vr_male_18,
vr_fem_net_change = prelim_vr_fem_19 - final_planned_vr_fem_18,
vr_fem_pct_change = vr_fem_net_change / final_planned_vr_fem_18,
vr_kuchi_net_change = prelim_vr_kuchi_19 / final_planned_vr_kuchi_18,
vr_kuchi_pct_change = vr_kuchi_net_change / final_planned_vr_kuchi_18,
vr_sikh_net_change = prelim_vr_sikh_19 - final_planned_vr_sikh_18,
vr_sikh_pct_change = vr_sikh_net_change / final_planned_vr_sikh_18
)
View(province_summary)
province_summary[11,1]
province_summary[11,2]
province_summary[11,4]
province_summary[11,4:35] <- NA
write.csv(province_summary, "./raw/af_province_vr_comparison_18_19.csv", row.names = F)
write.csv(output, "./raw/af_pc_vr_comparison_18_19.csv", row.names = F)
sum(province_summary$total_known_pcs)
sum(province_summary$pcs_with_vr_18)
sum(province_summary$pcs_with_vr_18, na.rm = T)
sum(province_summary$pcs_with_vr_19, na.rm = T)
sum(province_summary$pcs_missing_from_vr_19, na.rm = T)
sum(province_summary$pcs_that_added_vr_19, na.rm = T)
sum(province_summary$prelim_total_vr_18, na.rm = T)
sum(province_summary$final_planned_total_vr_18, na.rm = T)
sum(output$vr_final_total_18, na.rm = T)
sum(province_summary$prelim_results_pcs_18, na.rm = T)
sum(province_summary$final_results_pcs_18, na.rm = T)
sum(province_summary$prelim_total_vr_19, na.rm = T)
sum(output$vr_total_change[output$province_code == "27"])
sum(output$vr_total_change[output$province_code == "27"], na.rm = T)
View(output)
pc_df <- pc_df %>% mutate(
vr_male_change = ifelse(is.na(vr_male_19), 0, vr_male_19) - ifelse(is.na(vr_male_18), 0, vr_male_18),
vr_male_pct_change = vr_male_change / ifelse(is.na(vr_male_18), 0, vr_male_18),
vr_fem_change = ifelse(is.na(vr_fem_19), 0, vr_fem_19) - ifelse(is.na(vr_fem_18), 0, vr_fem_18),
vr_fem_pct_change = vr_fem_change / ifelse(is.na(vr_fem_18), 0, vr_fem_18),
vr_kuchi_change = ifelse(is.na(vr_kuchi_19), 0, vr_kuchi_19) - ifelse(is.na(vr_kuchi_18), 0, vr_kuchi_18),
vr_kuchi_pct_change = vr_kuchi_change / ifelse(is.na(vr_kuchi_18), 0, vr_kuchi_18),
vr_sikh_change = ifelse(is.na(vr_sikh_19), 0, vr_sikh_19) - ifelse(is.na(vr_sikh_18), 0, vr_sikh_18),
vr_sikh_pct_change = vr_sikh_change / ifelse(is.na(vr_sikh_18), 0, vr_sikh_18),
vr_total_change = ifelse(is.na(vr_prelim_total_19), 0, vr_prelim_total_19) - ifelse(is.na(vr_final_total_18), 0, vr_final_total_18),
vr_total_pct_change = vr_total_change / ifelse(is.na(vr_final_total_18), 0, vr_final_total_18),
vr_prelim_total_change = ifelse(is.na(vr_prelim_total_19), 0, vr_prelim_total_19) - ifelse(is.na(vr_prelim_total_18), 0, vr_prelim_total_18),
vr_prelim_total_change_pct = vr_prelim_total_change / ifelse(is.na(vr_prelim_total_18), 0, vr_prelim_total_18),
prelim_votes_18_pct_vr_18 = prelim_votes_18 / vr_final_total_18,
prelim_votes_18_pct_vr_19 = prelim_votes_18 / vr_prelim_total_19,
final_votes_18_pct_vr_18 = final_votes_18 / vr_final_total_18,
final_votes_18_pct_vr_19 = final_votes_18 / vr_prelim_total_19
)
View(pc_df)
output <- pc_df %>% left_join(dplyr::select(province_key, province_code, province_name_eng)) %>%
left_join(dplyr::select(district_key, district_sub_code, district_or_subdivision_name_eng)) %>% dplyr::select(
province_code, province_name_eng, district_sub_code, district_or_subdivision_name_eng, pc_code, pc_name_eng, pc_name_dari,
planned_18, prelim_results_18, prelim_votes_18, final_results_18, final_votes_18, missing_vr_19, new_vr_19,
vr_prelim_total_18, vr_final_total_18, vr_male_18, vr_fem_18, vr_kuchi_18, vr_sikh_18,
vr_prelim_total_19, vr_male_19, vr_fem_19, vr_kuchi_19, vr_sikh_19,
vr_total_change, vr_total_pct_change,
vr_male_change, vr_male_pct_change, vr_fem_change, vr_fem_pct_change,
vr_kuchi_change, vr_kuchi_pct_change, vr_sikh_change, vr_sikh_pct_change) %>%
arrange(province_code, district_sub_code, pc_code)
pc_df <- pc_key_2018 %>%
dplyr::select(
province_code, district_sub_code, pc_code, pc_name_eng, pc_name_dari,
planned_2018, prelim_results_reporting, final_results_reporting,
vr_prelim, vr_general_male, vr_general_fem, vr_final_kuchi, vr_final_sikh, vr_final_all_total) %>%
rename(
planned_18 = planned_2018,
prelim_results_18 = prelim_results_reporting,
final_results_18 = final_results_reporting,
vr_prelim_total_18 = vr_prelim,
vr_male_18 = vr_general_male,
vr_fem_18 = vr_general_fem,
vr_kuchi_18 = vr_final_kuchi,
vr_sikh_18 = vr_final_sikh,
vr_final_total_18 = vr_final_all_total
)
dupe_check <- pc_df %>% group_by(district_sub_code) %>%
mutate(double = ifelse(duplicated(pc_name_eng), "YES", "NO")) %>%
filter(double == "YES") %>% dplyr::select(pc_name_eng, double) %>%
right_join(pc_df) %>% dplyr::filter(double == "YES")
new_vr$pc_code <- as.character(str_pad(new_vr$pc_code, 7, pad = "0", side = "left"))
new_vr_join <- new_vr %>%
dplyr::select(pc_code, vr_male, vr_fem, vr_kuchi, vr_sikh, vr_total) %>%
rename(vr_male_19 = vr_male,
vr_fem_19 = vr_fem,
vr_kuchi_19 = vr_kuchi,
vr_sikh_19 = vr_sikh,
vr_prelim_total_19 = vr_total)
pc_df <- left_join(pc_df, new_vr_join)
pc_votes <- all_data_all_results %>% group_by(pc_code) %>% summarize(
prelim_votes_18 = sum(votes[results_status == "PRELIMINARY"], na.rm = T),
final_votes_18 = sum(votes[results_status == "FINAL"], na.rm = T)
)
pc_df <- left_join(pc_df, pc_votes)
pc_df <- pc_df %>% mutate(
missing_vr_19 = ifelse(!is.na(vr_final_total_18) & is.na(vr_prelim_total_19), "YES", "OK"),
new_vr_19 = ifelse(is.na(vr_final_total_18) & !is.na(vr_prelim_total_19), "NEW", "NO CHANGE")
)
pc_df <- pc_df %>% mutate(
vr_male_change = ifelse(is.na(vr_male_19), 0, vr_male_19) - ifelse(is.na(vr_male_18), 0, vr_male_18),
vr_male_pct_change = vr_male_change / ifelse(is.na(vr_male_18), 0, vr_male_18),
vr_fem_change = ifelse(is.na(vr_fem_19), 0, vr_fem_19) - ifelse(is.na(vr_fem_18), 0, vr_fem_18),
vr_fem_pct_change = vr_fem_change / ifelse(is.na(vr_fem_18), 0, vr_fem_18),
vr_kuchi_change = ifelse(is.na(vr_kuchi_19), 0, vr_kuchi_19) - ifelse(is.na(vr_kuchi_18), 0, vr_kuchi_18),
vr_kuchi_pct_change = vr_kuchi_change / ifelse(is.na(vr_kuchi_18), 0, vr_kuchi_18),
vr_sikh_change = ifelse(is.na(vr_sikh_19), 0, vr_sikh_19) - ifelse(is.na(vr_sikh_18), 0, vr_sikh_18),
vr_sikh_pct_change = vr_sikh_change / ifelse(is.na(vr_sikh_18), 0, vr_sikh_18),
vr_total_change = ifelse(is.na(vr_prelim_total_19), 0, vr_prelim_total_19) - ifelse(is.na(vr_final_total_18), 0, vr_final_total_18),
vr_total_pct_change = vr_total_change / ifelse(is.na(vr_final_total_18), 0, vr_final_total_18),
vr_prelim_total_change = ifelse(is.na(vr_prelim_total_19), 0, vr_prelim_total_19) - ifelse(is.na(vr_prelim_total_18), 0, vr_prelim_total_18),
vr_prelim_total_change_pct = vr_prelim_total_change / ifelse(is.na(vr_prelim_total_18), 0, vr_prelim_total_18),
prelim_votes_18_pct_vr_18 = prelim_votes_18 / vr_final_total_18,
prelim_votes_18_pct_vr_19 = prelim_votes_18 / vr_prelim_total_19,
final_votes_18_pct_vr_18 = final_votes_18 / vr_final_total_18,
final_votes_18_pct_vr_19 = final_votes_18 / vr_prelim_total_19
)
pc_df$district_sub_code[pc_df$pc_code == "0101555"] <- "0101-12"
pc_df$district_sub_code[pc_df$pc_code == "0101556"] <- "0101-12"
pc_df$district_sub_code[pc_df$pc_code == "0101559"] <- "0101-22"
output <- pc_df %>% left_join(dplyr::select(province_key, province_code, province_name_eng)) %>%
left_join(dplyr::select(district_key, district_sub_code, district_or_subdivision_name_eng)) %>% dplyr::select(
province_code, province_name_eng, district_sub_code, district_or_subdivision_name_eng, pc_code, pc_name_eng, pc_name_dari,
planned_18, prelim_results_18, prelim_votes_18, final_results_18, final_votes_18, missing_vr_19, new_vr_19,
vr_prelim_total_18, vr_final_total_18, vr_male_18, vr_fem_18, vr_kuchi_18, vr_sikh_18,
vr_prelim_total_19, vr_male_19, vr_fem_19, vr_kuchi_19, vr_sikh_19,
vr_total_change, vr_total_pct_change,
vr_male_change, vr_male_pct_change, vr_fem_change, vr_fem_pct_change,
vr_kuchi_change, vr_kuchi_pct_change, vr_sikh_change, vr_sikh_pct_change) %>%
arrange(province_code, district_sub_code, pc_code)
View(output)
View(output)
sum(output$vr_prelim_total_18)
sum(output$vr_prelim_total_18, na.rm = T)
sum(output$vr_prelim_total_18[output$planned_18 == "YES"], na.rm = T)
sum(output$vr_final_total_18[output$planned_18 == "YES"], na.rm = T)
sum(output$vr_final_total_18, na.rm = T)
sum(output$vr_prelim_total_19)
sum(output$vr_prelim_total_19, na.rm = T)
8834708 - 8778577
province_summary_new <- output %>% group_by(province_code, province_name_eng) %>%
summarize(
total_known_pcs = length(pc_code),
planned_pcs_18 = length(pc_code[planned_18 == "YES"]),
prelim_results_pcs_18 = length(pc_code[prelim_results_18 == "YES"]),
final_results_pcs_18 = length(pc_code[final_results_18 == "YES"]),
pcs_with_vr_18 = length(pc_code[!is.na(vr_final_total_18)]),
pcs_with_vr_not_planned_18 = length(pc_code[!is.na(vr_final_total_18) & planned_18 == "NO"]),
pcs_planned_but_missing_vr_18 = length(pc_code[is.na(vr_final_total_18) & planned_18 == "YES"]),
total_prelim_votes_18 = sum(prelim_votes_18, na.rm = T),
total_final_votes_18 = sum(final_votes_18, na.rm = T),
pcs_with_vr_19 = length(pc_code[!is.na(vr_prelim_total_19)]),
pcs_missing_from_vr_19 = length(pc_code[missing_vr_19 == "YES"]),
pcs_that_added_vr_19 = length(pc_code[new_vr_19 == "NEW"]),
prelim_total_vr_18 = sum(vr_prelim_total_18, na.rm = T),
final_planned_total_vr_18 = sum(vr_final_total_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_male_18 = sum(vr_male_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_fem_18 = sum(vr_fem_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_kuchi_18 = sum(vr_kuchi_18[planned_18 == "YES"]),
final_planned_vr_sikh_18 = sum(vr_sikh_18[planned_18 == "YES"]),
prelim_total_vr_19 = sum(vr_prelim_total_19, na.rm = T),
prelim_vr_male_19 = sum(vr_male_19, na.rm = T),
prelim_vr_fem_19 = sum(vr_fem_19, na.rm = T),
prelim_vr_kuchi_19 = sum(vr_kuchi_19, na.rm = T),
prelim_vr_sikh_19 = sum(vr_sikh_19, na.rm = T),
total_vr_net_change = prelim_total_vr_19 - final_planned_total_vr_18,
total_vr_pct_change = total_vr_net_change / final_planned_total_vr_18,
vr_male_net_change = prelim_vr_male_19 - final_planned_vr_male_18,
vr_male_pct_change = vr_male_net_change / final_planned_vr_male_18,
vr_fem_net_change = prelim_vr_fem_19 - final_planned_vr_fem_18,
vr_fem_pct_change = vr_fem_net_change / final_planned_vr_fem_18,
vr_kuchi_net_change = prelim_vr_kuchi_19 / final_planned_vr_kuchi_18,
vr_kuchi_pct_change = vr_kuchi_net_change / final_planned_vr_kuchi_18,
vr_sikh_net_change = prelim_vr_sikh_19 - final_planned_vr_sikh_18,
vr_sikh_pct_change = vr_sikh_net_change / final_planned_vr_sikh_18
)
setdiff(province_summary, province_summary_new)
write.csv(output, "./raw/af_pc_vr_comparison_18_19.csv", row.names = F)
setdiff(province_summary$total_vr_net_change, province_summary_new$total_vr_net_change)
setdiff(province_summary_new$total_vr_net_change, province_summary$total_vr_net_change)
province_summary <- output %>% group_by(province_code, province_name_eng) %>%
summarize(
total_known_pcs = length(pc_code),
planned_pcs_18 = length(pc_code[planned_18 == "YES"]),
prelim_results_pcs_18 = length(pc_code[prelim_results_18 == "YES"]),
final_results_pcs_18 = length(pc_code[final_results_18 == "YES"]),
pcs_with_vr_18 = length(pc_code[!is.na(vr_final_total_18)]),
pcs_with_vr_not_planned_18 = length(pc_code[!is.na(vr_final_total_18) & planned_18 == "NO"]),
pcs_planned_but_missing_vr_18 = length(pc_code[is.na(vr_final_total_18) & planned_18 == "YES"]),
total_prelim_votes_18 = sum(prelim_votes_18, na.rm = T),
total_final_votes_18 = sum(final_votes_18, na.rm = T),
pcs_with_vr_19 = length(pc_code[!is.na(vr_prelim_total_19)]),
pcs_missing_from_vr_19 = length(pc_code[missing_vr_19 == "YES"]),
pcs_that_added_vr_19 = length(pc_code[new_vr_19 == "NEW"]),
prelim_total_vr_18 = sum(vr_prelim_total_18, na.rm = T),
final_planned_total_vr_18 = sum(vr_final_total_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_male_18 = sum(vr_male_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_fem_18 = sum(vr_fem_18[planned_18 == "YES"], na.rm = T),
final_planned_vr_kuchi_18 = sum(vr_kuchi_18[planned_18 == "YES"]),
final_planned_vr_sikh_18 = sum(vr_sikh_18[planned_18 == "YES"]),
prelim_total_vr_19 = sum(vr_prelim_total_19, na.rm = T),
prelim_vr_male_19 = sum(vr_male_19, na.rm = T),
prelim_vr_fem_19 = sum(vr_fem_19, na.rm = T),
prelim_vr_kuchi_19 = sum(vr_kuchi_19, na.rm = T),
prelim_vr_sikh_19 = sum(vr_sikh_19, na.rm = T),
total_vr_net_change = prelim_total_vr_19 - final_planned_total_vr_18,
total_vr_pct_change = total_vr_net_change / final_planned_total_vr_18,
vr_male_net_change = prelim_vr_male_19 - final_planned_vr_male_18,
vr_male_pct_change = vr_male_net_change / final_planned_vr_male_18,
vr_fem_net_change = prelim_vr_fem_19 - final_planned_vr_fem_18,
vr_fem_pct_change = vr_fem_net_change / final_planned_vr_fem_18,
vr_kuchi_net_change = prelim_vr_kuchi_19 / final_planned_vr_kuchi_18,
vr_kuchi_pct_change = vr_kuchi_net_change / final_planned_vr_kuchi_18,
vr_sikh_net_change = prelim_vr_sikh_19 - final_planned_vr_sikh_18,
vr_sikh_pct_change = vr_sikh_net_change / final_planned_vr_sikh_18
)
province_summary[11,4:35] <- NA
write.csv(province_summary, "./raw/af_province_vr_comparison_18_19.csv", row.names = F)
sum(output$vr_final_total_18[output$missing_vr_19 == "YES"])
sum(output$vr_prelim_total_19[output$new_vr_19 == "NEW"])
View(province_summary)
sum(output$vr_total_change[output$province_code == "27"], na.rm = T)
sum(output$vr_prelim_total_19[output$province_code == "27"])
sum(output$vr_prelim_total_19[output$province_code == "27"], na.rm = T)
sum(output$vr_final_total_18[output$province_code == "27"], na.rm = T)
sum(output$vr_final_total_18[output$province_code == "27" & planned_2018 == "YES"], na.rm = T)
sum(output$vr_final_total_18[output$province_code == "27" & output$planned_2018 == "YES"], na.rm = T)
sum(output$vr_final_total_18[output$province_code == "27" & output$planned_18 == "YES"], na.rm = T)
sum(output$vr_prelim_total_19[output$province_code == "27" & output$planned_18 == "YES"], na.rm = T)
province_summary <- output %>% group_by(province_code, province_name_eng) %>%
summarize(
total_known_pcs = length(pc_code),
planned_pcs_18 = length(pc_code[planned_18 == "YES"]),
prelim_results_pcs_18 = length(pc_code[prelim_results_18 == "YES"]),
final_results_pcs_18 = length(pc_code[final_results_18 == "YES"]),
pcs_with_vr_18 = length(pc_code[!is.na(vr_final_total_18)]),
pcs_with_vr_not_planned_18 = length(pc_code[!is.na(vr_final_total_18) & planned_18 == "NO"]),
pcs_planned_but_missing_vr_18 = length(pc_code[is.na(vr_final_total_18) & planned_18 == "YES"]),
total_prelim_votes_18 = sum(prelim_votes_18, na.rm = T),
total_final_votes_18 = sum(final_votes_18, na.rm = T),
pcs_with_vr_19 = length(pc_code[!is.na(vr_prelim_total_19)]),
pcs_missing_from_vr_19 = length(pc_code[missing_vr_19 == "YES"]),
pcs_that_added_vr_19 = length(pc_code[new_vr_19 == "NEW"]),
prelim_total_vr_18 = sum(vr_prelim_total_18, na.rm = T),
final_total_vr_18 = sum(vr_final_total_18, na.rm = T),
final_total_vr_18_at_planned_pcs = sum(vr_final_total_18[planned_18 == "YES"], na.rm = T),
final_male_vr_18 = sum(vr_male_18, na.rm = T),
final_male_vr_18_at_planned_pcs = sum(vr_male_18[planned_18 == "YES"], na.rm = T),
final_fem_vr_18 = sum(vr_fem_18, na.rm = T),
final_fem_vr_18_at_planned_pcs = sum(vr_fem_18[planned_18 == "YES"], na.rm = T),
final_kuchi_vr_18 = sum(vr_kuchi_18, na.rm = T),
final_kuchi_vr_18_at_planned_pcs = sum(vr_kuchi_18[planned_18 == "YES"]),
final_sikh_vr_18 = sum(vr_sikh_18, na.rm = T),
final_sikh_vr_18_at_planned_pcs = sum(vr_sikh_18[planned_18 == "YES"]),
prelim_total_vr_19 = sum(vr_prelim_total_19, na.rm = T),
prelim_vr_male_19 = sum(vr_male_19, na.rm = T),
prelim_vr_fem_19 = sum(vr_fem_19, na.rm = T),
prelim_vr_kuchi_19 = sum(vr_kuchi_19, na.rm = T),
prelim_vr_sikh_19 = sum(vr_sikh_19, na.rm = T),
total_vr_net_change = prelim_total_vr_19 - final_total_vr_18,
total_vr_pct_change = total_vr_net_change / final_total_vr_18,
vr_male_net_change = prelim_vr_male_19 - final_male_vr_18,
vr_male_pct_change = vr_male_net_change / final_male_vr_18,
vr_fem_net_change = prelim_vr_fem_19 - final_fem_vr_18,
vr_fem_pct_change = vr_fem_net_change / final_fem_vr_18,
vr_kuchi_net_change = prelim_vr_kuchi_19 / final_kuchi_vr_18,
vr_kuchi_pct_change = vr_kuchi_net_change / final_kuchi_vr_18,
vr_sikh_net_change = prelim_vr_sikh_19 - final_sikh_vr_18,
vr_sikh_pct_change = vr_sikh_net_change / final_sikh_vr_18
)
province_summary[11,4:35] <- NA
write.csv(province_summary, "./raw/af_province_vr_comparison_18_19.csv", row.names = F)
length(output$pc_code[output$province_code == "27" & output$planned_18 == "NO" & !is.na(output$vr_prelim_total_19)])
length(output$pc_code[output$planned_18 == "NO" & !is.na(output$vr_prelim_total_19)])
sum(output$vr_prelim_total_19, na.rm = T)
View(province_summary)
sum(province_summary$prelim_total_vr_19, na.rm = T)
sum(province_summary$final_total_vr_18, na.rm = T)
8834708 - 8843151
sum(province_summary$prelim_vr_male_19, na.rm = T)
sum(province_summary$prelim_vr_fem_19, na.rm = T)
sum(province_summary$prelim_vr_kuchi_19, na.rm = T)
sum(province_summary$prelim_vr_sikh_19, na.rm = T)
sum(province_summary$final_male_vr_18, na.rm = T)
sum(province_summary$final_fem_vr_18, na.rm = T)
sum(province_summary$final_kuchi_vr_18, na.rm = T)
output <- output %>% mutate(prelim_overvote = ifelse(prelim_votes_18 > vr_prelim_total_19, "YES", "NO"), final_overvote = ifelse(final_votes_18 > vr_prelim_total_19))
output <- output %>% mutate(prelim_overvote = ifelse(prelim_votes_18 > vr_prelim_total_19, "YES", "NO"), final_overvote = ifelse(final_votes_18 > vr_prelim_total_19, "YES", "NO"))
sum(output$prelim_votes_18[output$prelim_overvote == "YES"])
sum(output$prelim_votes_18[output$prelim_overvote == "YES"], na.rm = T)
sum(output$final_votes_18[output$final_overvote == "YES"], na.rm = T)
sum(output$vr_prelim_total_19[output$final_overvote == "YES"], na.rm = T)
sum(output$vr_prelim_total_19[output$prelim_overvote == "YES"], na.rm = T)
View(all_out)
summary(as.factor(all_out$status))
View(pc_key_2014)
View(pc_key_2014)
View(pc_key_2014)
View(candidate_key_2014)
View(runoff_prelim)
write.csv(runoff_prelim, "./past_elections/presidential_2014/raw/raw_runoff_preliminary_results_and_extra_ballots_by_ps.csv", row.names = F)
View(candidate_key_2014)
View(pc_key_2014)
runoff_pc_not_in_key <- setdiff(pc_key_2014$pc_code, all_out$pc_code)
View(pc_key_2014)
pc_key_2014 <- read.csv("./past_elections/presidential_2014/keyfiles/pc_key_2014.csv", stringsAsFactors = F)
pc_key_2014$province_code <- as.character(str_pad(pc_key_2014$province_code, 2, pad = "0", side = "left"))
pc_key_2014$district_code <- as.character(str_pad(pc_key_2014$province_code, 4, pad = "0", side = "left"))
pc_key_2014$pc_code <- as.character(str_pad(pc_key_2014$pc_code, 7, pad = "0", side = "left"))
pc_key_2014 <- read.csv("./past_elections/presidential_2014/keyfiles/pc_key_2014.csv", stringsAsFactors = F)
pc_key_2014$province_code <- as.character(str_pad(pc_key_2014$province_code, 2, pad = "0", side = "left"))
pc_key_2014$district_code <- as.character(str_pad(pc_key_2014$district_code, 4, pad = "0", side = "left"))
pc_key_2014$pc_code <- as.character(str_pad(pc_key_2014$pc_code, 7, pad = "0", side = "left"))
candidate_key_2014 <- read.csv("./past_elections/presidential_2014/keyfiles/candidate_key_2014.csv", stringsAsFactors = F)
View(candidate_key_2014)
runoff_pc_not_in_key <- setdiff(pc_key_2014$pc_code, all_out$pc_code)
View(pc_key_2014)
runoff_pc_not_in_key <- setdiff(all_out$pc_code, pc_key_2014$pc_code)
runoff_pc_not_in_key <- setdiff(all_out$pc_code, pc_key_2014$pc_code)
runoff_prelim_output <- all_out %>% left_join(candidate_key_2014)
View(runoff_prelim_output)
runoff_prelim_output <- all_out %>% left_join(candidate_key_2014) %>% filter(!is.na(ballot_position))
summary(as.factor(runoff_prelim_output$status))
runoff_prelim_error_check <- all_out %>% group_by(ps_code) %>% summarize(
AA_votes = votes[candidate_name_eng == "Dr. Abdullah Abdullah"],
AG_votes = votes[candidate_name_eng == "Mohammad Ashraf Ghani Ahmadzai"],
total_votes = votes[candidate_name_eng == "Total Valid"],
unused_ballots = votes[candidate_name_eng == "Unused Ballots"],
spoiled_ballots = votes[candidate_name_eng == "Spoiled Ballots"],
invalid_ballots = votes[candidate_name_eng == "Invalid Ballots"],
discrepancy = votes[candidate_name_eng == "Discrepancy"],
total_check = ifelse(AA_votes + AG_votes != total_votes, AA_votes + AG_votes, "OK"),
discrepancy_check = ifelse((600 - (total_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
600 - (total_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
View(runoff_prelim)
runoff_prelim_error_check <- runoff_prelim %>% group_by(ps_code) %>% summarize(
total_check = ifelse(AA_votes + AG_votes != total_valid, AA_votes + AG_votes, "OK"),
discrepancy_check = ifelse((600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
runoff_prelim_error_check <- runoff_prelim %>% group_by(ps_code) %>% rowwise %>% summarize(
total_check = ifelse(AA_votes + AG_votes != total_valid, AA_votes + AG_votes, "OK"),
discrepancy_check = ifelse((600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
summary(as.factor(runoff_prelim$AA_votes))
runoff_prelim_error_check <- runoff_prelim %>% group_by(ps_code) %>% summarize(
total_check = ifelse(as.numeric(AA_votes) + as.numeric(AG_votes) != total_valid, as.numeric(AA_votes) + as.numeric(AG_votes), "OK")
#  discrepancy_check = ifelse((600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
#                             600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
runoff_prelim_error_check <- runoff_prelim %>% group_by(ps_code) %>% summarize(
total_check = ifelse(as.numeric(AA_votes) + as.numeric(AG_votes) != as.numeric(total_valid), as.numeric(AA_votes) + as.numeric(AG_votes), "OK")
#  discrepancy_check = ifelse((600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
#                             600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
runoff_prelim_error_check <- runoff_prelim %>% summarize(
total_check = ifelse(as.numeric(AA_votes) + as.numeric(AG_votes) != as.numeric(total_valid), as.numeric(AA_votes) + as.numeric(AG_votes), "OK")
#  discrepancy_check = ifelse((600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
#                             600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
runoff_prelim_error_check <- runoff_prelim %>% group_by(ps_code) %>% summarize(
total_check = ifelse(as.numeric(AA_votes) + as.numeric(AG_votes) != as.numeric(total_valid),
as.character(as.numeric(AA_votes) + as.numeric(AG_votes)),
"OK")
#  discrepancy_check = ifelse((600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
#                             600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
runoff_prelim_error_check <- runoff_prelim %>% group_by(ps_code) %>% summarize(
total_check = ifelse(as.numeric(AA_votes) + as.numeric(AG_votes) != as.numeric(total_valid),
"ERROR", "OK")
#  discrepancy_check = ifelse((600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
#                             600 - (AA_votes + AG_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
runoff_prelim_error_check <- all_out %>% group_by(ps_code) %>% summarize(
AA_votes = votes[candidate_name_eng == "Dr. Abdullah Abdullah"],
AG_votes = votes[candidate_name_eng == "Mohammad Ashraf Ghani Ahmadzai"],
total_votes = votes[candidate_name_eng == "Total Valid"],
unused_ballots = votes[candidate_name_eng == "Unused Ballots"],
spoiled_ballots = votes[candidate_name_eng == "Spoiled Ballots"],
invalid_ballots = votes[candidate_name_eng == "Invalid Ballots"],
discrepancy = votes[candidate_name_eng == "Discrepancy"],
total_check = ifelse(AA_votes + AG_votes != total_votes, AA_votes + AG_votes, "OK"),
discrepancy_check = ifelse((600 - (total_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
600 - (total_votes + unused_ballots + spoiled_ballots + invalid_ballots), "OK")
)
runoff_prelim_error_check <- all_out %>% group_by(ps_code) %>% summarize(
AA_votes = votes[candidate_name_eng == "Dr. Abdullah Abdullah"],
AG_votes = votes[candidate_name_eng == "Mohammad Ashraf Ghani Ahmadzai"],
total_votes = votes[candidate_name_eng == "Total Valid"],
unused_ballots = votes[candidate_name_eng == "Unused Ballots"],
spoiled_ballots = votes[candidate_name_eng == "Spoiled Ballots"],
invalid_ballots = votes[candidate_name_eng == "Invalid Ballots"],
discrepancy = votes[candidate_name_eng == "Discrepancy"],
total_check = ifelse(AA_votes + AG_votes != total_votes, "ERROR", "OK"),
discrepancy_check = ifelse((600 - (total_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
"ERROR", "OK")
)
runoff_prelim_output <- all_out
runoff_prelim_output[1:17] <- as.character(runoff_prelim_output[1:17])
View(runoff_prelim_output)
View(runoff_prelim_output)
summary(as.factor(runoff_prelim_output$pc_code))
View(runoff_prelim_output)
runoff_prelim_output <- all_out
runoff_prelim_output[] <- lapply(all_out, as.character)
View(runoff_prelim_output)
class(runoff_prelim_output)
runoff_prelim_output$votes <- as.numeric(runoff_prelim_output$votes)
runoff_prelim_output <- runoff_prelim_output %>% left_join(candidate_key_2014) %>% filter(!is.na(ballot_position))
runoff_prelim_error_check <- runoff_prelim_output %>% group_by(ps_code) %>% summarize(
AA_votes = votes[candidate_name_eng == "Dr. Abdullah Abdullah"],
AG_votes = votes[candidate_name_eng == "Mohammad Ashraf Ghani Ahmadzai"],
total_votes = votes[candidate_name_eng == "Total Valid"],
unused_ballots = votes[candidate_name_eng == "Unused Ballots"],
spoiled_ballots = votes[candidate_name_eng == "Spoiled Ballots"],
invalid_ballots = votes[candidate_name_eng == "Invalid Ballots"],
discrepancy = votes[candidate_name_eng == "Discrepancy"],
total_check = ifelse(AA_votes + AG_votes != total_votes, "ERROR", "OK"),
discrepancy_check = ifelse((600 - (total_votes + unused_ballots + spoiled_ballots + invalid_ballots) != discrepancy),
"ERROR", "OK")
)
runoff_prelim_output %>% runoff_prelim_output %>% dplyr::select(
election_type, election_date, results_status, results_date,
province_code, province_name_eng, province_name_dari, district_code, district_name_eng,
pc_code, pc_name_eng, pc_name_dari,
ps_code, ps_type,
ballot_position, candidate_code, candidate_name_eng, candidate_name_dari, party_name_dari, candidate_gender,
votes, first_round_winner, run_off_winner, past_winners, results_barcode
) %>% arrange(province_code, district_code, pc_code, ps_code, ballot_position)
runoff_prelim_output <- runoff_prelim_output %>% dplyr::select(
election_type, election_date, results_status, results_date,
province_code, province_name_eng, province_name_dari, district_code, district_name_eng,
pc_code, pc_name_eng, pc_name_dari,
ps_code, ps_type,
ballot_position, candidate_code, candidate_name_eng, candidate_name_dari, party_name_dari, candidate_gender,
votes, first_round_winner, run_off_winner, past_winners, results_barcode
) %>% arrange(province_code, district_code, pc_code, ps_code, ballot_position)
write.csv(runoff_prelim_output,
"./past_elections/presidential_2014/results_data/run_off_preliminary_results/prelim_af_candidate_ps_data_run_off_2014.csv",
row.names = F)
runoff_prelim_lite <- runoff_prelim_output %>% dplyr::select(ps_code, candidate_code, votes)
write.csv(runoff_prelim_lite,
"./past_elections/presidential_2014/results_data/run_off_preliminary_results/prelim_af_candidate_ps_data_run_off_2014_lite.csv",
row.names = F)
